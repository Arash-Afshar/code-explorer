<div class="min-h-screen bg-base-100">
  <div class="container mx-auto px-4 py-8">
    <!-- Back Button -->
    <div class="mb-6">
      <%= link_to pdfs_path, class: "btn btn-outline btn-primary" do %>
        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"></path>
        </svg>
        Back to PDFs
      <% end %>
    </div>

    <!-- PDF Details Card -->
    <div class="card bg-base-100 shadow-xl mb-8">
      <div class="card-body">
        <h2 class="card-title text-2xl mb-6">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
          </svg>
          <%= @pdf.name %>
        </h2>

        <!-- Status Badge -->
        <div class="mb-6">
          <% case @pdf.processing_status %>
          <% when 'pending' %>
            <div class="badge badge-warning badge-lg gap-2">
              <span class="loading loading-spinner loading-sm"></span>
              Pending Processing
            </div>
          <% when 'processing' %>
            <div class="badge badge-info badge-lg gap-2">
              <span class="loading loading-spinner loading-sm"></span>
              Currently Processing
            </div>
          <% when 'completed' %>
            <div class="badge badge-success badge-lg gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"></path>
              </svg>
              Processing Completed
            </div>
          <% when 'failed' %>
            <div class="badge badge-error badge-lg gap-2">
              <svg class="w-4 h-4" fill="currentColor" viewBox="0 0 20 20">
                <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
              </svg>
              Processing Failed
            </div>
          <% else %>
            <div class="badge badge-neutral badge-lg">Unknown Status</div>
          <% end %>
        </div>

        <!-- Error Message if Failed -->
        <% if @pdf.processing_status == 'failed' && @pdf.processing_error.present? %>
          <div class="alert alert-error mb-6">
            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            <div>
              <h3 class="font-bold">Processing Error</h3>
              <div class="text-xs"><%= @pdf.processing_error %></div>
            </div>
          </div>
        <% end %>

        <!-- PDF Information -->
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div class="space-y-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">PDF ID</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= @pdf.id %>
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">Created At</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= @pdf.created_at.strftime("%B %d, %Y at %I:%M %p") %>
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">Last Updated</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= @pdf.updated_at.strftime("%B %d, %Y at %I:%M %p") %>
              </div>
            </div>
          </div>

          <div class="space-y-4">
            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">Processing Status</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= @pdf.processing_status&.titleize || 'Not Set' %>
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">Sections Extracted</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= @pdf.pdf_sections.count %> sections
              </div>
            </div>

            <div class="form-control">
              <label class="label">
                <span class="label-text font-semibold">File Size</span>
              </label>
              <div class="input input-bordered bg-base-200">
                <%= number_to_human_size(@pdf.content&.bytesize || 0) %>
              </div>
            </div>
          </div>
        </div>

        <!-- Actions -->
        <div class="card-actions justify-end mt-6">
          <% if @pdf.processing_status == 'failed' %>
            <%= link_to "Retry Processing", "#", class: "btn btn-warning" %>
          <% end %>

          <%= link_to pdf_path(@pdf), 
              data: { 
                confirm: "Are you sure you want to delete this PDF?",
                turbo_method: :delete
              },
              class: "btn btn-error" do %>
            <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"></path>
            </svg>
            Delete PDF
          <% end %>
        </div>
      </div>
    </div>

    <!-- Sections List (if completed) -->
    <% if @pdf.processing_status == 'completed' && @pdf.pdf_sections.any? %>
      <div class="card bg-base-100 shadow-xl">
        <div class="card-body">
          <h3 class="card-title text-xl mb-4">
            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0V5a2 2 0 012-2h6a2 2 0 012 2v2M7 7h10"></path>
            </svg>
            Extracted Sections (<%= @pdf.pdf_sections.count %>)
          </h3>

          <div class="overflow-x-auto">
            <table class="table table-zebra w-full">
              <thead>
                <tr>
                  <th>Section ID</th>
                  <th>Title</th>
                  <th>Page</th>
                  <th>Position</th>
                </tr>
              </thead>
              <tbody>
                <% @pdf.pdf_sections.each do |section| %>
                  <tr>
                    <td><%= section.section_number %></td>
                    <td class="font-medium"><%= section.title %></td>
                    <td><%= section.page_number %></td>
                    <td>
                      <span class="text-xs">
                        x:<%= section.x %>, y:<%= section.y %><br>
                        w:<%= section.width %>, h:<%= section.endy - section.y if section.endy %>
                      </span>
                    </td>
                  </tr>
                <% end %>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    <% end %>
  </div>
</div>

<script>
  // Auto-refresh the page every 10 seconds if still processing
  <% if ['pending', 'processing'].include?(@pdf.processing_status) %>
    setTimeout(function() {
      location.reload();
    }, 10000);
  <% end %>
</script>

